"""
Classifies: CHEBI:25029 leukotriene
"""
"""
Classifies: CHEBI:35908 leukotriene

Any icosanoid from that family of C20 polyunsaturated fatty acids and their derivatives generated by leukocytes from arachidonic acid, each member having four double bonds of which three are conjugated.
"""
from rdkit import Chem
from rdkit.Chem import AllChem
from rdkit.Chem import rdMolDescriptors

def is_leukotriene(smiles: str):
    """
    Determines if a molecule is a leukotriene based on its SMILES string.

    Args:
        smiles (str): SMILES string of the molecule

    Returns:
        bool: True if molecule is a leukotriene, False otherwise
        str: Reason for classification
    """
    
    # Parse SMILES
    mol = Chem.MolFromSmiles(smiles)
    if mol is None:
        return False, "Invalid SMILES string"

    # Check for minimum 4 double bonds
    n_double_bonds = sum(bond.GetIsAromatic() and bond.GetIsConjugated() for bond in mol.GetBonds())
    if n_double_bonds < 4:
        return False, f"Found {n_double_bonds} double bonds, need at least 4"

    # Check for hydroxy and carbonyl/carboxylic acid groups
    has_hydroxy = any(atom.GetHybridization() == Chem.HybridizationType.SP3 and
                      atom.GetTotalNumHs() == 1 for atom in mol.GetAtoms())
    has_carbonyl = any(atom.GetHybridization() == Chem.HybridizationType.SP2 and
                       atom.GetTotalNumHs() == 0 for atom in mol.GetAtoms())
    if not (has_hydroxy and has_carbonyl):
        return False, "Missing hydroxy and carbonyl/carboxylic acid groups"

    # Check for a carbon chain length of 18-22
    c_count = sum(1 for atom in mol.GetAtoms() if atom.GetAtomicNum() == 6)
    if not 18 <= c_count <= 22:
        return False, "Carbon chain length outside the expected range (18-22)"

    # Check molecular weight - leukotrienes typically 300-500 Da
    mol_wt = rdMolDescriptors.CalcExactMolWt(mol)
    if not 300 <= mol_wt <= 500:
        return False, "Molecular weight outside the expected range (300-500 Da)"

    return True, "Meets the structural requirements for a leukotriene"