"""
Classifies: CHEBI:25029 leukotriene
"""
"""
Classifies: CHEBI:16122 leukotriene

A leukotriene is defined as any icosanoid from that family of C20 polyunsaturated fatty acids and 
their derivatives generated by leukocytes from arachidonic acid, each member having four double bonds
of which three are conjugated.
"""

from rdkit import Chem

def is_leukotriene(smiles: str):
    """
    Determines if a molecule is a leukotriene based on its SMILES string.

    Args:
        smiles (str): SMILES string of the molecule

    Returns:
        bool: True if molecule is a leukotriene, False otherwise
        str: Reason for classification
    """

    # Parse SMILES
    mol = Chem.MolFromSmiles(smiles)
    if mol is None:
        return False, "Invalid SMILES string"

    # Check for 20 carbon atoms
    if sum(1 for atom in mol.GetAtoms() if atom.GetAtomicNum() == 6) != 20:
        return False, "Does not contain 20 carbon atoms"

    # Check for 4 double bonds
    bond_orders = [bond.GetBondType() for bond in mol.GetBonds()]
    n_double_bonds = sum(1 for bond in bond_orders if bond == Chem.BondType.DOUBLE)
    if n_double_bonds != 4:
        return False, f"Found {n_double_bonds} double bonds, expected 4"

    # Check for 3 conjugated double bonds
    bond_orders = [bond.GetBondType() for bond in mol.GetBonds()]
    conjugated = False
    for i in range(len(bond_orders) - 4):
        if bond_orders[i] == Chem.BondType.DOUBLE and \
           bond_orders[i+1] == Chem.BondType.SINGLE and \
           bond_orders[i+2] == Chem.BondType.DOUBLE and \
           bond_orders[i+3] == Chem.BondType.SINGLE and \
           bond_orders[i+4] == Chem.BondType.DOUBLE:
            conjugated = True
            break
    if not conjugated:
        return False, "Does not contain 3 conjugated double bonds"

    # Check for hydroxy group
    if sum(1 for atom in mol.GetAtoms() if atom.GetAtomicNum() == 8 and sum(bond.GetBondTypeAsDouble() for bond in atom.GetBonds()) == 1) < 1:
        return False, "Does not contain a hydroxy group"

    # Check for carboxylic acid group
    if sum(1 for atom in mol.GetAtoms() if atom.GetAtomicNum() == 8 and sum(bond.GetBondTypeAsDouble() for bond in atom.GetBonds()) == 2) < 1:
        return False, "Does not contain a carboxylic acid group"

    return True, "Satisfies the structural requirements for a leukotriene"