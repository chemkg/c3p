"""
Classifies: CHEBI:25029 leukotriene
"""
"""
Classifies: CHEBI:18014 leukotriene

A leukotriene is any icosanoid from that family of C20 polyunsaturated fatty acids 
and their derivatives generated by leukocytes from arachidonic acid, each member 
having four double bonds of which three are conjugated.
"""
from rdkit import Chem
from rdkit.Chem import AllChem
from rdkit.Chem import rdMolDescriptors

def is_leukotriene(smiles: str):
    """
    Determines if a molecule is a leukotriene based on its SMILES string.

    Args:
        smiles (str): SMILES string of the molecule

    Returns:
        bool: True if molecule is a leukotriene, False otherwise
        str: Reason for classification
    """
    
    # Parse SMILES
    mol = Chem.MolFromSmiles(smiles)
    if mol is None:
        return False, "Invalid SMILES string"
    
    # Check for conjugated double bond system
    conj_diene_pattern = Chem.MolFromSmarts("[C=C,C=C,C=C,C=C]")
    conj_diene_matches = mol.GetSubstructMatches(conj_diene_pattern)
    if not conj_diene_matches:
        return False, "No conjugated diene system found"
    
    # Check for carboxylic acid group
    carboxyl_pattern = Chem.MolFromSmarts("C(=O)O")
    carboxyl_match = mol.GetSubstructMatch(carboxyl_pattern)
    if carboxyl_match is None:
        return False, "No carboxylic acid group found"
    
    # Check for alcohol group
    alcohol_pattern = Chem.MolFromSmarts("O[H]")
    alcohol_match = mol.GetSubstructMatch(alcohol_pattern)
    if alcohol_match is None:
        return False, "No alcohol group found"
    
    # Optionally, check for cysteinyl group
    cysteinyl_pattern = Chem.MolFromSmarts("C(=O)NC[C@@H](N)C(=O)O")
    cysteinyl_match = mol.GetSubstructMatch(cysteinyl_pattern)
    
    # Count double bonds (leukotrienes typically have 4-5)
    num_double_bonds = rdMolDescriptors.CalcNumAlkeneDouble(mol)
    if num_double_bonds < 4 or num_double_bonds > 5:
        return False, f"Found {num_double_bonds} double bonds, expected 4-5"
    
    # Count rotatable bonds (leukotrienes typically have 6-10)
    num_rotatable = rdMolDescriptors.CalcNumRotatableBonds(mol)
    if num_rotatable < 6 or num_rotatable > 10:
        return False, f"Found {num_rotatable} rotatable bonds, expected 6-10"
    
    # Additional checks if needed, e.g., molecular weight range
    
    return True, "Contains conjugated diene system, carboxylic acid group, and alcohol group"