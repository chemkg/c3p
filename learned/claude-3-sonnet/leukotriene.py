"""
Classifies: CHEBI:25029 leukotriene
"""
"""
Classifies: CHEBI:36114 leukotriene
A leukotriene is any icosanoid from the family of C20 polyunsaturated fatty acids and their derivatives generated by leukocytes from arachidonic acid, each member having four double bonds of which three are conjugated.
"""
from rdkit import Chem
from rdkit.Chem import AllChem
from rdkit.Chem import rdMolDescriptors

def is_leukotriene(smiles: str):
    """
    Determines if a molecule is a leukotriene based on its SMILES string.

    Args:
        smiles (str): SMILES string of the molecule

    Returns:
        bool: True if molecule is a leukotriene, False otherwise
        str: Reason for classification
    """
    
    # Parse SMILES
    mol = Chem.MolFromSmiles(smiles)
    if mol is None:
        return False, "Invalid SMILES string"
    
    # Check for 20 carbons
    c_count = sum(1 for atom in mol.GetAtoms() if atom.GetAtomicNum() == 6)
    if c_count != 20:
        return False, f"Found {c_count} carbons, leukotriene must have exactly 20"
    
    # Check for 4 double bonds
    bond_count = sum(1 for bond in mol.GetBonds() if bond.GetBondType() == Chem.BondType.DOUBLE)
    if bond_count != 4:
        return False, f"Found {bond_count} double bonds, leukotriene must have exactly 4"
    
    # Check if 3 double bonds are conjugated
    conj_pattern = Chem.MolFromSmarts("[C]=[C][C]=[C][C]=[C]")
    conj_matches = mol.GetSubstructMatches(conj_pattern)
    if len(conj_matches) < 1:
        return False, "No conjugated triene system found"
    
    # Check for carboxylic acid
    cooh_pattern = Chem.MolFromSmarts("C(=O)O")
    cooh_matches = mol.GetSubstructMatches(cooh_pattern)
    if len(cooh_matches) != 1:
        return False, f"Found {len(cooh_matches)} carboxylic acid groups, leukotriene must have exactly 1"
    
    # Check for alcohol
    oh_pattern = Chem.MolFromSmarts("O")
    oh_matches = mol.GetSubstructMatches(oh_pattern)
    if len(oh_matches) < 1:
        return False, "No alcohol group found, leukotriene must have at least 1"
    
    # Optional: Check for common leukotriene substructures like cysteinyl group
    cys_pattern = Chem.MolFromSmarts("C(N)CS")
    cys_matches = mol.GetSubstructMatches(cys_pattern)
    
    return True, "Molecule meets criteria for leukotriene: 20 carbons, 4 double bonds (3 conjugated), carboxylic acid, alcohol"